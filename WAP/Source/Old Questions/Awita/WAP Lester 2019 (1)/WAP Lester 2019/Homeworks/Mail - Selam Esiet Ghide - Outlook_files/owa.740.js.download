self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.740.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[740],{14120:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1260),i=n(869),a=n(740),s=n(1570),d=n(62),u=n(731);function c(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,o;return Object(r.__generator)(this,function(r){return 1===(n=t.tableQuery).listViewType?(o={Id:e,mailboxInfo:Object(i.c)(n)},[2,Object(s.e)(o,"LoadNudgedItem")]):[2,l(e,t)]})})}function l(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,c;return Object(r.__generator)(this,function(r){return n=t.tableQuery,c=Object(i.c)(n),[2,a.E.importAndExecute(Object(u.i)(n),e,Object(o.f)(n),n.requestShapeName,c.requestOptions).then(function(t){if("Success"==t.ResponseClass){var n=t.Conversations;if(n&&n.length>0&&n[0].ConversationId.Id===e){var r={Id:e,mailboxInfo:c};return Object(s.d)(r,"LoadNudgedConversation"),n[0]}}return null}).catch(function(e){return d.d.warn("loadNudgedConversation throws an exception"+e.message),null})]})})}var f=n(245),b=n(467),w="https://outlook.office.com/FocusedInboxB2";function I(){return Object(r.__awaiter)(this,void 0,void 0,function(){var e,t;return Object(r.__generator)(this,function(n){switch(n.label){case 0:return[4,g()];case 1:return e=n.sent(),t=new Headers,e&&(t.authorization="Bearer "+e),[2,t]}})})}function g(){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(e){return Object(f.a)()?[2,null]:[2,Object(b.getAccessTokenforResource)(w)]})})}var v=n(112),O="FocusedInboxB2/api/v1/Nudges/GetNudges";function m(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return[4,I()];case 1:return t=r.sent(),[4,Object(v.b)(O,e,!0,t)];case 2:n=r.sent(),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,n.json()];case 4:return[2,r.sent()];case 5:return r.sent(),[2,null];case 6:return[2]}})})}var h=n(3),j=n(737);function p(e){switch(e){case"Received":return 0;case"Sent":return 1;default:return d.d.warn("No nudge reason returned in GetNudge server response"),0}}var y=n(65),N=n(1638),_=n(1302),R=n(5447);function C(e){if(!Object(y.f)("tri-nudge")||Object(R.a)(16))return!1;if(e!==Object(j.a)("inbox")&&e!==Object(j.a)("sentitems"))return!1;var t=Object(u.B)();if("All"!=Object(u.I)(t))return!1;var n=Object(u.l)(t);if(0!=n&&-1!=n)return!1;var r=Object(u.p)(t.id);if(0!=r&&1!=r)return!1;var o=Object(N.a)(e),i={sortColumn:1,sortDirection:_.DESCENDING_SORT_DIR};return o.sortColumn==i.sortColumn&&o.sortDirection==i.sortDirection}var K=n(1669),S=n(2743),T=n(1235);function A(e,t){var n=t.rowKeys.indexOf(e);if(n>=0&&!u.b.getIsPinned(e,t)){var r=Object(S.a)(u.b.getLastDeliveryOrRenewTimeStamp(e,t),u.b.getLastDeliveryTimeStamp(e,t),t,n+1,!0);-1==r?Object(K.a)([e],t):T.a.updateRowPosition(--r,e,t)}}var x=n(151),V=n(52),D=n(319),E=n(2030),k=n(1032),M=n(1426),P=n(758);var F=!1,L=Object(V.e)(E.a,"clone_onSelectFolderComplete",function(e){return Object(r.__awaiter)(void 0,void 0,void 0,function(){var t,n,o,i,a,s,c,l,f,b,w;return Object(r.__generator)(this,function(I){switch(I.label){case 0:return F||!C(e.selectedFolderId)?[2]:(t=Object(u.B)()).tableQuery.folderId!=e.selectedFolderId?[2]:(F=!0,[4,m(n=Object(D.a)())]);case 1:if(o=I.sent(),i=[],!(null===(w=o)||void 0===w?void 0:w.Nudges))return[3,5];a=o.Nudges,s=0,I.label=2;case 2:return s<a.length?[4,U(a[s],t)]:[3,5];case 3:(c=I.sent())&&(i.push(c),Object(x.m)("TnS_GetNudge",[n,c.itemId])),I.label=4;case 4:return s++,[3,2];case 5:return l=Object(h.a)("testOldNudge"),0!=decodeURIComponent(l||"").trim().length&&(i.push({rowKey:"testNudgeRowKey",itemId:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId=",conversationId:"getTestNudgeRowDataForRowNotLoadedInTableViewConversationId=",tableViewId:t.id,reason:0,daysAgo:7}),f={ConversationId:{__type:"ItemId:#Exchange",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewConversationId="},ConversationTopic:"This is a test Nudge Email that is older than the loaded rows",UniqueSenders:["Sayali Shah"],LastDeliveryTime:"2019-10-01T15:30:58-07:00",HasAttachments:!1,MessageCount:1,GlobalMessageCount:1,UnreadCount:1,GlobalUnreadCount:1,Size:1234,ItemClasses:["IPM.Note"],Importance:null,ItemIds:[{__type:"ItemId:#Exchange",ChangeKey:"CQAAAA==",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId="}],GlobalItemIds:[{__type:"ItemId:#Exchange",ChangeKey:"CQAAAA==",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId="}],LastModifiedTime:"2019-10-29T15:30:59-07:00",InstanceKey:"testNudgeRowKey",Preview:"Test nudge email for row that is not loaded",HasIrm:!1,IsLocked:!1,FamilyId:{__type:"ItemId:#Exchange",Id:"AAQkAGZjM2NmMGY1LTkzMzgtNGNhMy04ODg5LWQwMjJjMDc0YjJlMAAQAH9+ZbR0rbRFncY81mWHT1E="},LastDeliveryOrRenewTime:"2019-10-01T15:30:58-07:00",HasAttachmentPreviews:!1,LastSender:{Mailbox:{Name:"Sayali Shah",EmailAddress:"sayalis@microsoft.com",RoutingType:"SMTP"}}},t.rowKeys.indexOf("testNudgeRowKey")<0&&(b=Object(k.f)(t,0),T.a.addRow(b,f,t))),i.push.apply(i,Object(r.__spread)(function(e){var t=Object(h.a)("testNudge");if(0==decodeURIComponent(t||"").trim().length)return[];var n=[];if(e.rowKeys.length>0){var r=e.tableQuery.folderId===Object(j.a)("sentitems")?1:0,o={rowKey:e.rowKeys[0],itemId:u.b.getItemIds(e.rowKeys[0],e)[0],conversationId:u.b.getConversationId(e.rowKeys[0],e),tableViewId:e.id,reason:r,daysAgo:5};if(n.push(o),e.rowKeys.length>3){var i={rowKey:e.rowKeys[3],itemId:u.b.getItemIds(e.rowKeys[3],e)[0],conversationId:u.b.getConversationId(e.rowKeys[3],e),tableViewId:e.id,reason:r,daysAgo:0};n.push(i)}if(e.rowKeys.length>10&&1===Math.floor(2*Math.random())){var a={rowKey:e.rowKeys[10],itemId:u.b.getItemIds(e.rowKeys[10],e)[0],conversationId:u.b.getConversationId(e.rowKeys[10],e),tableViewId:e.id,reason:r,daysAgo:3};n.push(a)}}return n}(t))),Object(M.e)().nudgedRows.forEach(function(e){Object(M.k)(e.rowKey,e.tableViewId)||i.some(function(t){return t.rowKey===e.rowKey&&t.tableViewId===e.tableViewId})||A(e.rowKey,t)}),Object(M.i)(i,t),d.d.info("Nudge: onSelectFolderCompleteOrchestrator new nudges length: "+i.length),F=!1,[2]}})})});function U(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,o,a,l,f,b,w,I,g;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e.FolderId.Id!=t.tableQuery.folderId?[2,null]:(n=e.ItemId.Id,o=e.ConversationId.Id,a=0===t.tableQuery.listViewType?o:n,l=void 0,0!==(f=Object(u.A)([a],t)).length?[3,2]:[4,c(a,t)]);case 1:return(b=r.sent())?(l=b.InstanceKey,w=Object(y.f)("tri-spotlight")&&0===e.NudgeReason.EmailAgeInDays,t.rowKeys.indexOf(l)<0&&!w&&(I=Object(k.f)(t,0),T.a.addRow(I,b,t)),[3,3]):(d.d.warn("Nudge: Unable to load nudged row for list view type:"+t.tableQuery.listViewType+" itemId: "+n+" conversationId: "+o+" folderId: "+t.tableQuery.folderId),[2,null]);case 2:l=f[0],function(e,t){if(1===e.listViewType){var n=Object(P.b)().items.get(t);n&&n.NormalizedBody||Object(s.e)({Id:t,mailboxInfo:Object(i.c)(e)},"LoadNudgedItem")}else Object(P.b)().conversations.get(t)||Object(s.d)({Id:t,mailboxInfo:Object(i.c)(e)},"LoadNudgedConversation")}(t.tableQuery,a),r.label=3;case 3:return[2,{rowKey:l,itemId:n,conversationId:o,tableViewId:t.id,reason:p(e.NudgeReason.Reason),daysAgo:e.NudgeReason.EmailAgeInDays}];case 4:return g=r.sent(),d.d.warn("Nudge: processNudgeResponse throws an exception"+g.message),[2,null];case 5:return[2]}})})}var B=n(121),Q="FocusedInboxB2/api/v1/Nudges/UpdateNudge";function G(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,o,i;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return[4,I()];case 1:return n=r.sent(),o={ItemId:{Id:e},NudgeAction:t},[4,Object(v.d)(Q,o,Object(D.a)(),!1,n)];case 2:i=r.sent();try{Object(B.a)(i.status)||d.d.warn("updateNudgesOperation return http status "+i.status)}catch(e){return d.d.info("updateNudgesOperation return error "+e.message),[2,null]}return[2]}})})}var z=n(1286),H=n(2608),J=n(2609),q=n(4828),Y=n(5156),W=n(5157),Z=n(5978),$=Object(V.e)(Z.b,"clone_onNudgeInfoBarClicked",function(e){var t=e.response===Z.a.MarkComplete?"MarkedComplete":"Dismissed";de(e.rowKey,e.itemId,t,"ReadingPane")}),X=Object(V.e)(Y.a,"clone_onDismissNudgeClicked",function(e){Object(M.e)().nudgedRows.filter(function(t){return t.rowKey===e.rowKey&&t.tableViewId===e.tableViewId}).forEach(function(t){de(e.rowKey,t.itemId,"Dismissed",e.actionSource)})}),ee=Object(V.e)(W.a,"clone_removeSpotlight",function(e){var t=e.rowKey||Object(M.b)(e.itemOrConversationId)||Object(M.c)(e.itemOrConversationId);Object(M.e)().nudgedRows.filter(function(n){return n.rowKey===t&&n.tableViewId===e.tableViewId||n.itemId===e.itemOrConversationId||n.conversationId===e.itemOrConversationId}).forEach(function(n){de(t,n.itemId,"Dismissed",e.actionSource)})}),te=Object(V.e)(z.a,"clone_deleteItemsStoreUpdate",function(e){e.itemContexts.map(function(e){return e.itemId}).forEach(function(e){var t=Object(M.c)(e);t&&Object(M.j)(t)})}),ne=Object(V.e)(K.a,"clone_removeRowsFromListViewStore",function(e){ae(e.rowKeys,e.tableView.id)}),re=Object(V.e)(J.a,"clone_markItemsAsPinnedStoreUpdate",function(e){se(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned),e.shouldMarkAsPinned&&ae(e.rowKeys,e.tableViewId)}),oe=Object(V.e)(H.a,"clone_markConversationsAsPinnedStoreUpdate",function(e){se(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned),e.shouldMarkAsPinned&&ae(e.rowKeys,e.tableViewId)}),ie=Object(V.e)(q.a,"clone_onSendMessageSucceeded",function(e){var t=e.operation;if(1===t||2===t||3===t){e.referenceItemId||d.d.warn("Nudge: referenceItemId should not be null for r/R/f operations");var n=e.referenceItemId.Id,r=e.conversationId,o=Object(M.c)(n);o||(o=Object(M.b)(r)),o?(Object(M.j)(o),A(o,Object(u.B)())):d.d.warn("Nudge: row cannot be removed after r/R/F as rowKey not found for item id: "+n+" conversationId: "+r),Object(x.m)("TnS_ReplyNudge",[t,n,r,o],{logEvery:Object(y.f)("ring-dogfood")?1:20})}});function ae(e,t){e.forEach(function(e){Object(M.f)(e,t)&&Object(M.j)(e)})}function se(e,t,n){e.forEach(function(e){Object(M.e)().nudgedRows.filter(function(n){return n.rowKey===e&&n.tableViewId===t}).forEach(function(e){var t=n?"Pinned":"Unpinned";G(e.itemId,t),ue([t,e.itemId,"PinUnpin"])})})}function de(e,t,n,r){G(t,n),Object(M.j)(e),A(e,Object(u.B)()),ue([n,t,r])}function ue(e){Object(x.m)("TnS_UpdateNudge",e,{logEvery:Object(y.f)("ring-dogfood")?1:20})}var ce=n(4);function le(e,t,n,r,o){if(!Object(M.k)(e,t.id)){if(u.b.getIsPinned(e,t))d.d.info("Nudge: "+o+" updateNudgedRowPosition - row is pinned");else{var i=Object(k.f)(t,0);T.a.updateRowPosition(i,e,t),d.d.info("Nudge: "+o+" updateNudgedRowPosition - row is inserted at "+i)}Object(x.m)("TnS_UpdateNudgePosition",[r,n])}}Object(ce.orchestrator)(M.i,function(e){e.nudgedRows.forEach(function(t){return le(t.rowKey,e.tableView,t.conversationId,t.itemId,"onGetNudge")})}),Object(ce.orchestrator)(k.i,function(e){var t=Object(M.e)().nudgedRows,n=e.tableView;t.filter(function(e){return e.tableViewId==n.id}).forEach(function(t){return le(t.rowKey,e.tableView,t.conversationId,t.itemId,"onMerge")})}),n.d(t,"getNudgesOrchestrator",function(){return L}),n.d(t,"removeNudgeOnInfoBarClickedOrchestrator",function(){return $}),n.d(t,"removeNudgeOnDismissNudgeClickedOrchestrator",function(){return X}),n.d(t,"removeNudgeOnItemDeleteStoreUpdateOrchestrator",function(){return te}),n.d(t,"removeNudgeOnRowsDeleteStoreUpdateOrchestrator",function(){return ne}),n.d(t,"removeNudgeOnItemsPinnedStoreUpdateOrchestrator",function(){return re}),n.d(t,"removeNudgeOnConversationsPinnedStoreUpdateOrchestrator",function(){return oe}),n.d(t,"removeNudgeOnReplyOrReplyAllOrForwardOrchestrator",function(){return ie}),n.d(t,"removeSpotlightOrchestrator",function(){return ee})},161:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,o=!1;function i(t){r--,delete e[t]}this.put=function(t,n,o,a){if(void 0!==o&&("number"!=typeof o||isNaN(o)||o<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==a&&"function"!=typeof a)throw new Error("Cache timeout callback must be a function");var s=e[t];s?clearTimeout(s.timeout):r++;var d={value:n,expire:o+Date.now()};return isNaN(d.expire)||(d.timeout=setTimeout(function(){i(t),a&&a(t,n)}.bind(this),o)),e[t]=d,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&i(t),n},this.clear=function(){for(var i in e)clearTimeout(e[i].timeout);r=0,e=Object.create(null),o&&(t=0,n=0)},this.get=function(i){var a=e[i];if(void 0!==a){if(isNaN(a.expire)||a.expire>=Date.now())return o&&t++,a.value;o&&n++,r--,delete e[i]}else o&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){o=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),o=Date.now(),i=n&&n.skipDuplicates;for(var a in r)if(r.hasOwnProperty(a)){if(i)if(e[a])continue;var s=r[a],d=s.expire-o;if(d<=0){this.del(a);continue}d=d>0?d:void 0,this.put(a,s.value,d)}return this.size()}}e.exports=new r,e.exports.Cache=r},298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"TokenRequest:#Exchange"},e)}},339:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(129),o=n(298);t.default=function(e,t){return void 0===e||e.__type||(e=o.default(e)),r.makeServiceRequest("GetAccessTokenforResource",e,t)}},5447:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a});var r=n(71),o=n(69);function i(e){return!!(e&Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags)}var a=Object(o.action)("setBit")(function(e,t){i(t)!==e&&(e?Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags|=t:Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags&=~t)})}},0,[3,5,8,13,422,1,2,22,577,185,0,578,189,7,379,16,361,10,626,444,6,355,79,4,12,131,37,127,38,73,358,49,353,565,110,609,370,342,376,541,716]]);
//# sourceMappingURL=owa.740.js.map
self.scriptsLoaded['owa.740.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.740.js'] = (new Date()).getTime();