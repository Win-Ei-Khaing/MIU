self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SubstrateSuggestions.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[466],{1052:function(t,e,n){"use strict";n.d(e,"c",function(){return o}),n.d(e,"b",function(){return i}),n.d(e,"a",function(){return c});var r=n(34),u=n(50);function o(){var t=Object(r.getCookie)("targetServer"),e="DefaultAnchorMailbox"+(t?"_"+t.toLocaleLowerCase():"");return Object(r.getCookie)(e)}function i(){var t="",e=Object(u.a)().pathname.split("/").filter(function(t){return t.length});return e.length>=2&&e[1].match(/.+@.+/)&&(t=e[1]),t}function c(){var t=i();return t||(t=o()),t}},14367:function(t,e,n){"use strict";n.r(e);var r=n(0),u=n(4017),o=n(69),i=n(966),c=n(71),a=Object(o.action)("execute3SPrimeCall")(function(t){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(e){switch(e.label){case 0:return t?[4,i.b.importAndExecute()]:[3,2];case 1:e.sent(),e.label=2;case 2:return Object(u.a)(Object(c.j)(),"",!1),[2]}})})});n.d(e,"execute3SPrimeCall",function(){return a})},1445:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(4),u=n(812),o=Object(r.mutatorAction)("updateBindStatus",function(t){Object(u.a)().status=t})},153:function(t,e,n){"use strict";function r(t,e){Object.keys(e).forEach(function(n){return t.set(n,e[n])})}function u(t){var e=t.requestOptions;return e||(e={headers:new Headers}),e.datapoint=e.datapoint||{},e.datapoint.mailbox="Default",e}n.d(e,"b",function(){return r}),n.d(e,"a",function(){return u})},161:function(t,e,n){"use strict";function r(){var t=Object.create(null),e=0,n=0,r=0,u=!1;function o(e){r--,delete t[e]}this.put=function(e,n,u,i){if(void 0!==u&&("number"!=typeof u||isNaN(u)||u<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==i&&"function"!=typeof i)throw new Error("Cache timeout callback must be a function");var c=t[e];c?clearTimeout(c.timeout):r++;var a={value:n,expire:u+Date.now()};return isNaN(a.expire)||(a.timeout=setTimeout(function(){o(e),i&&i(e,n)}.bind(this),u)),t[e]=a,n},this.del=function(e){var n=!0,r=t[e];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&o(e),n},this.clear=function(){for(var o in t)clearTimeout(t[o].timeout);r=0,t=Object.create(null),u&&(e=0,n=0)},this.get=function(o){var i=t[o];if(void 0!==i){if(isNaN(i.expire)||i.expire>=Date.now())return u&&e++,i.value;u&&n++,r--,delete t[o]}else u&&n++;return null},this.size=function(){return r},this.memsize=function(){var e,n=0;for(e in t)n++;return n},this.debug=function(t){u=t},this.hits=function(){return e},this.misses=function(){return n},this.keys=function(){return Object.keys(t)},this.exportJson=function(){var e={};for(var n in t){var r=t[n];e[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(e)},this.importJson=function(e,n){var r=JSON.parse(e),u=Date.now(),o=n&&n.skipDuplicates;for(var i in r)if(r.hasOwnProperty(i)){if(o)if(t[i])continue;var c=r[i],a=c.expire-u;if(a<=0){this.del(i);continue}a=a>0?a:void 0,this.put(i,c.value,a)}return this.size()}}t.exports=new r,t.exports.Cache=r},164:function(t,e,n){"use strict";var r=n(4),u=Object(r.action)("addAccount",function(t){return{primarySmtpAddress:t.primarySmtpAddress,account:t}}),o=Object(r.action)("removeAccount",function(t){return{primarySmtpAddress:t}}),i=Object(r.action)("updateAccount",function(t,e,n){return{primarySmtpAddress:t,accountToken:e,accountTokenExpiresIn:n}}),c=Object(r.action)("updateOWAConnectedAccountStatus",function(t,e){return{primarySmtpAddress:t,isAccountValid:e}}),a=n(0),s=n(21),d=n(7);Object(r.mutator)(u,function(t){var e=t.account;f().accountsMap.set(e.primarySmtpAddress,e)}),Object(r.mutator)(o,function(t){var e=t.primarySmtpAddress;f().accountsMap.delete(e)}),Object(r.mutator)(i,function(t){var e=t.primarySmtpAddress,n=t.accountToken,r=t.accountTokenExpiresIn,u=f().accountsMap.get(e);u.token=n,u.tokenExpiry=Object(d.j)(Object(d.Ob)(),parseInt(r))}),Object(r.mutator)(c,function(t){var e=t.primarySmtpAddress,n=t.isAccountValid;f().accountsMap.get(e).isAccountValid=n});var f=Object(r.createStore)("OWAAccountsStore",{accountsMap:new s.ObservableMap({})}),l=n(160);function p(t){return void 0!==v(t)}function b(){return Object(a.__spread)(f().accountsMap.values())}function v(t){return f().accountsMap.get(t)}function O(t){return p(t)?v(t).accountProviderType:null}function h(t){return"Outlook"==t.accountProviderType?'MSAuth1.0 usertoken="'+t.token+'", type="MSACT"':"Google"==t.accountProviderType||"ICloud"==t.accountProviderType?"Bearer "+t.token:Object(l.a)(t.accountProviderType)}function j(t,e){return function(n){var r=v(n);return r?r[t]:e}}j("accountUniqueId","0");var m=j("isAccountValid",!0),w=j("accountProviderType",null),y=function(t){return"Outlook"==w(t)};n.d(e,"a",function(){return u}),n.d(e,"i",function(){return o}),n.d(e,"k",function(){return i}),n.d(e,"j",function(){return c}),n.d(e,"f",function(){return b}),n.d(e,"c",function(){return v}),n.d(e,"b",function(){return O}),n.d(e,"e",function(){return h}),n.d(e,"d",function(){return m}),n.d(e,"h",function(){return y}),n.d(e,"g",function(){return p})},201:function(t,e,n){"use strict";var r=n(0),u=n(52),o=new u.c(function(){return n.e(541).then(n.bind(null,14388))}),i=new u.a(o,function(t){return t.getAndUpdateRefreshToken}),c=n(164),a=n(323),s=n(151),d="X-AnchorMailbox",f="Authorization",l="X-OwaWebSessionType";function p(t){return Object(r.__awaiter)(this,void 0,void 0,function(){var e,n,u,o,p;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return e={},(n=Object(c.c)(t))?(u=n.token,e[d]=n.anchorMailbox,o=Object(a.g)(n.tokenExpiry),u||Object(s.m)("[getConnectedAccountHeaders] Invalid account token"),!o&&u?[3,2]:[4,i.importAndExecute(n.accountId,t)]):[3,3];case 1:(u=r.sent())||(u="",Object(s.m)("[getConnectedAccountHeaders] Token refresh failed")),r.label=2;case 2:p=void 0,"Outlook"==n.accountProviderType?(p='MSAuth1.0 usertoken="'+u+'", type="MSACT"',e[l]=1..toString()):"Google"!=n.accountProviderType&&"ICloud"!=n.accountProviderType||(p="Bearer "+u,e[l]=2..toString()),e[f]=p,r.label=3;case 3:return[2,e]}})})}var b=n(153);function v(t){return Object(r.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return e=Object(b.a)(t),n=e,[4,O(t.primarySmtpAddress)];case 1:return n.headers=r.sent(),e.authNeededOnUnAuthorized=!1,e.datapoint=e.datapoint||{},e.datapoint.mailbox="Connected",[2,e]}})})}function O(t){return Object(r.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return e=new Headers,[4,p(t)];case 1:return n=r.sent(),Object(b.b)(e,n),[2,e]}})})}n.d(e,"a",function(){return p}),n.d(e,"b",function(){return v})},298:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);e.default=function(t){return r.__assign({__type:"TokenRequest:#Exchange"},t)}},339:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(129),u=n(298);e.default=function(t,e){return void 0===t||t.__type||(t=u.default(t)),r.makeServiceRequest("GetAccessTokenforResource",t,e)}},3505:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(65),u=["Id","ADObjectId","DisplayName","EmailAddresses","PeopleSubtype","PeopleType","PDLItemId","PersonaId","ImAddress","JobTitle"];function o(){return Object(r.f)("rp-peopleSuggestionsTrie")?u.concat(["FeatureData"]):u}},4017:function(t,e,n){"use strict";var r=n(0),u=n(164),o=n(201),i=n(966);function c(){return"Bound"==Object(i.f)().status}var a=n(65),s=n(319),d=n(121),f=n(112),l=n(1052),p=n(245),b=n(3505),v=n(467),O=n(62);n.d(e,"a",function(){return _});var h="/search/api/v1/init?",j="https://outlook.office365.com/search",m="https://substrate.office.com/SubstrateSearch-Internal.ReadWrite",w="/search/api/v1/suggestions?",y="owa.react.compose",g="20",k="5";function _(t,e,n,u,o,i){var c,a;return Object(r.__awaiter)(this,void 0,void 0,function(){var d,l,p,b;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return""!=e?[3,1]:[2,A()];case 1:return[4,S(e,n,i)];case 2:return d=r.sent(),l=function(t,e){return{AppName:"OWA",Scenario:{Name:y},Cvid:e||Object(s.a)(),EntityRequests:[t]}}(d,null===(c=o)||void 0===c?void 0:c.conversationId),p=f.d,b=[w+x(),l,u,!1],[4,I(t,null===(a=o)||void 0===a?void 0:a.clientSessionId)];case 3:return[2,p.apply(void 0,b.concat([r.sent(),!0,!0,!1])).then(function(t){return t}).catch(function(t){return O.d.info(t),null})]}})})}function A(){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,e,n,u,o,i;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return Object(p.a)()&&Object(a.f)("rp-linkedInPeopleSuggestions")&&c()?((t={}).headers=new Headers,[4,Object(v.getDelegationTokenForOwa)(m)]):[3,3];case 1:return e=r.sent(),t.headers.set("X-User-Context","litoken=bearer"),t.headers.set("Authorization","Bearer "+e),(n=Object(l.c)())&&t.headers.append("X-AnchorMailbox",n),t.method="GET",[4,fetch(window.location.origin+h+x(),t)];case 2:return(u=r.sent())&&200==u.status?[2,u]:(O.d.error("makeInitRequest: Unsuccessful response status"),[2,null]);case 3:return o=f.b,i=[h+x(),void 0,!0],[4,I(null)];case 4:return[2,o.apply(void 0,i.concat([r.sent(),!0,!1])).then(function(t){return Object(d.a)(t.status)?t.json():null}).catch(function(t){return O.d.error(t),null})]}})})}function S(t,e,n){return Object(r.__awaiter)(this,void 0,void 0,function(){var u,o;return Object(r.__generator)(this,function(r){return u=Object(a.f)("rp-linkedInPeopleSuggestions")&&c(),o={Query:{QueryString:t},EntityType:"People",Provenances:T(e,u),Size:e?g:k},n&&n.length>0&&(o.Context=function(t){var e={};t&&(e.RecipientsTo=t.toString());return e}(n)),o.Fields=Object(b.a)(),[2,o]})})}function T(t,e){var n=["Mailbox"];return t&&!Object(p.a)()&&n.push("Directory"),e&&n.push("LinkedIn"),n}function x(){var t={scenario:y};return Object.keys(t).map(function(e){return e+"="+t[e]}).join("&")}function I(t,e){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,i;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return n={},e&&(n["client-session-id"]=e),Object(a.f)("rp-linkedInPeopleSuggestions")&&c()?Object(p.a)()?(n["X-User-Context"]="litoken=bearer",[3,3]):[3,1]:[3,3];case 1:return[4,Object(v.getAccessTokenforResource)(j)];case 2:i=r.sent(),n["X-User-Context"]="litoken="+i,r.label=3;case 3:return t&&Object(u.g)(t)?[2,Object(o.a)(t).then(function(t){return Object.keys(t).forEach(function(e){return n[e]=t[e]}),n})]:[2,n]}})})}},812:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n(4),u=Object(r.createStore)("linkedInStore",{status:null})},966:function(t,e,n){"use strict";var r=n(52),u=n(1445),o=n(151);var i=n(812);function c(){return"Unbound"===Object(i.a)().status}function a(){return"Bound"===Object(i.a)().status}function s(){var t=Object(i.a)();return null==t.status||"OptOut"==t.status||"OptOutBound"==t.status||"DisabledBound"==t.status}n.d(e,"a",function(){return f}),n.d(e,"b",function(){return l}),n.d(e,"e",function(){return c}),n.d(e,"f",function(){return i.a}),n.d(e,"c",function(){return a}),n.d(e,"d",function(){return s});var d=new r.c(function(){return Promise.all([n.e(4),n.e(321)]).then(n.bind(null,14240))}),f=new r.a(d,function(t){return t.connectToLinkedIn}),l=new r.a(d,function(t){return t.initializeBindStatus});"undefined"!=typeof window&&void 0!==window.Owa&&(window.Owa.completeLinkedInBind=function(t){Object(o.m)("linkedInBindComplete",[t]),Object(u.a)(t?"Unbound":"Bound")})}},0,[565,110,541]]);
//# sourceMappingURL=owa.SubstrateSuggestions.js.map
self.scriptsLoaded['owa.SubstrateSuggestions.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SubstrateSuggestions.js'] = (new Date()).getTime();