self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.ExpandedListSelectionActions.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[229],{14133:function(e,t,n){"use strict";n.r(t);var o=n(5),a=n(21),i=n(731),r=n(758),c=n(1834),s=n(62);function d(e,t){var n=function(e){var t={},n=r.a.conversationNodes.get(e);for(;n;){if(t[n.internetMessageId]){s.d.error("Invalid loop found in ParentInternetMessageId pointers");break}if(Object(c.b)(n.internetMessageId)&&(t[n.internetMessageId]=!0),Object(o.g)(n.parentInternetMessageId))break;n=r.a.conversationNodes.get(n.parentInternetMessageId)}return t}(e);if(1===Object.keys(n).length)return function(e,t){var n=new a.ObservableMap({});return t.forEach(function(t){var o=r.a.conversationNodes.get(t),a=t===e?i.a.CheckMark:i.a.None;n.set(o.internetMessageId,a)}),n}(e,t);for(var d=new a.ObservableMap({}),u=!1,l=!1,v=0,b=0;b<t.length;b++){var I=r.a.conversationNodes.get(t[b]);n[I.internetMessageId]?(u?v+1===Object.keys(n).length?(d.set(I.internetMessageId,i.a.BusEnd),l=!0):d.set(I.internetMessageId,i.a.BusStop):(d.set(I.internetMessageId,i.a.BusStart),u=!0),v++):!u||l?d.set(I.internetMessageId,i.a.None):d.set(I.internetMessageId,i.a.NoStop)}return d}var u=n(893),l=n(4),v=Object(l.action)("FOCUS_ITEM_PART",function(e,t){return{nodeId:e,mailListItemSelectionSource:t}}),b=n(748),I=n(6125),O=n(740);function f(){var e=b.a.expandedConversationViewState;e.expandedRowKey=null,e.focusedNodeId=null,e.selectedNodeIds=[],e.allNodeIds=[],e.shouldBeExpanded=!1,e.busStopStateMap=new a.ObservableMap({})}Object(l.mutator)(u.t,function(e){var t=e.nodeId,n=b.a.expandedConversationViewState,o=n.selectedNodeIds,a=n.allNodeIds;b.a.expandedConversationViewState.focusedNodeId=t,o.indexOf(t)>-1?o.splice(o.indexOf(t),1):o.push(t),1===o.length&&(b.a.expandedConversationViewState.busStopStateMap=d(o[0],a))}),Object(l.mutator)(u.h,function(e){b.a.expandedConversationViewState.busStopStateMap=new a.ObservableMap({})}),Object(l.mutator)(v,function(e){b.a.expandedConversationViewState.focusedNodeId=e.nodeId}),Object(l.mutator)(u.q,function(e){var t=e.rowKey,n=e.nodeIdToSelect,o=e.allNodeIds,a=b.a.expandedConversationViewState;a.selectedNodeIds=[n],a.busStopStateMap=d(n,o),a.expandedRowKey=t,a.focusedNodeId=n,a.allNodeIds=o}),Object(l.mutator)(u.u,function(e){e.mailListItemSelectionSource===O.c.MailListItemCheckbox&&f()}),Object(l.mutator)(u.p,function(e){f()}),Object(l.mutator)(u.i,function(e){f()}),Object(l.mutator)(u.k,function(e){f()}),Object(l.mutator)(u.r,function(e){var t=b.a.expandedConversationViewState;e.mailListItemSelectionSource==O.c.MailListItemTwisty&&t.expandedRowKey!=e.rowKey&&(t.expandedRowKey=e.rowKey,t.shouldBeExpanded=!0)}),Object(l.mutator)(u.o,function(e){b.a.expandedConversationViewState.shouldBeExpanded=e.shouldBeExpanded}),Object(l.mutator)(I.a,function(e){if(1===b.a.expandedConversationViewState.selectedNodeIds.length){var t=b.a.expandedConversationViewState.selectedNodeIds[0],n=O.H.conversations.get(e.conversationId).conversationNodeIds;b.a.expandedConversationViewState.busStopStateMap=d(t,n)}});var w,p=n(0),m=n(6660),S=n(1776),j=n(1318),N=n(807),x=n(4827);Object(l.orchestrator)(u.b,function(e){C(e.itemId,e.tableView,e.nodeId,e.allNodeIds,e.mailListItemSelectionSource)});Object(l.orchestrator)(u.e,function(e){if(e.mailListItemSelectionSource==O.c.MailListItemTwisty){if(1==e.listViewType)throw new Error("Toggle expansion action cannot be called from message view");var t,n;Object(m.a)(e.rowKey)?R():(t=e.rowKey,n=e.tableView,u.o(!1),Object(x.a)(n,!1),h(t,n))}}),Object(l.orchestrator)(u.c,function(e){Object(m.a)(e.rowKey)&&R()}),Object(l.orchestrator)(u.m,function(e){for(var t=i.b.getConversationId(e.rowKey,e.tableView),n=O.H.conversations.get(t),o=null,a=null,r=n.conversationNodeIds.indexOf(i.O.expandedConversationViewState.selectedNodeIds[0])+1;r<n.conversationNodeIds.length;r++){var s=n.conversationNodeIds[r],d=Object(c.b)(s);if(d){a=d.ItemId.Id,o=s;break}}o?C(a,e.tableView,o,n.conversationNodeIds,O.c.RowRemoval):h(e.rowKey,e.tableView)});var g=0,V=!0;function C(e,t,n,o,a){if(w&&(clearTimeout(w),w=null),Object(S.f)(t,!0,a),a!==O.c.KeyboardUpDown||Object(N.b)())j.m.importAndExecute(e,!0);else{var r=Date.now(),c=r-g;g=r,(V||c<=500)&&(V=!1,w=setTimeout(function(){w=null,V=!0,j.m.importAndExecute(e,!0)},250))}u.q(i.O.expandedConversationViewState.expandedRowKey,n,o,t.id)}function h(e,t){var n,o,a=i.b.getConversationId(e,t),r=O.H.conversations.get(a);try{for(var s=Object(p.__values)(r.conversationNodeIds),d=s.next();!d.done;d=s.next()){var u=d.value,l=Object(c.b)(u);if(l){C(l.ItemId.Id,t,u,r.conversationNodeIds,O.c.RowRemoval);break}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}}function R(){u.i()}var y=n(5431),M=n(5434),E=(Object(l.orchestrator)(M.a,function(e){Object(y.a)(),1===Object(i.E)().expandedConversationViewState.selectedNodeIds.length&&u.h()}),n(7088)),_=n(984),K=(Object(l.orchestrator)(E.a,function(e){if(i.O.expandedConversationViewState.expandedRowKey){var t=O.H.conversations.get(e.conversationId);u.q(i.O.expandedConversationViewState.expandedRowKey,e.conversationNodeId,t.conversationNodeIds,Object(_.a)())}}),n(6130)),L=n(4503),T=n(4916),P=n(1726),D=Object(l.action)("FOCUS_ROW_IN_DIRECTION",function(e,t,n){return{tableView:e,selectionDirection:t,mailListItemSelectionSource:n}});function A(e,t,n){return Object(P.a)()?1===e&&n===i.d.Next||0===e&&n===i.d.Previous:e===t-1&&n===i.d.Next||e===t-2&&n===i.d.Previous}Object(l.orchestrator)(K.a,function(e){var t=e.selectionDirection,n=e.tableView,o=e.mailListItemSelectionSource,a=e.shouldSelect,r=Object(p.__read)(function(e,t){var n=i.O.expandedConversationViewState,o=n.focusedNodeId,a=n.allNodeIds;if(!o)return[null,null];var r,s,d=a.indexOf(o);e===i.d.Next?(r=a.length-1,s=1):(r=0,s=-1);var u=Object(i.F)(t.focusedRowKey,t.id).id,l=i.O.conversationItems.get(u);for(;d!==r;){if(d+=s,Object(L.a)(l.id)&&A(d,a.length,e))return Object(T.a)(l.clientId),["loading",null];var v=a[d],b=Object(c.b)(v);if(b)return[v,b]}return[null,null]}(t,n),2),s=r[0],d=r[1];"loading"!==s&&(s?a?u.b(s,d.ItemId.Id,i.O.expandedConversationViewState.allNodeIds,n,o):v(s,o):i.O.expandedConversationViewState.expandedRowKey&&t===i.d.Previous?u.c(i.O.expandedConversationViewState.expandedRowKey):a?u.n(n,t,o):D(n,t,o))});var k=n(8418),B=n(4306),U=n(4042),H=n(4041),q=(Object(l.orchestrator)(D,function(e){var t=e.tableView,n=e.selectionDirection,o=Object(k.a)(t,n);if(null!==o){var a=t.rowKeys[o];Object(B.a)(t,a),Object(H.a)(t,a),Object(U.a)(t,null),u.i()}}),n(6131));Object(l.orchestrator)(q.a,function(e){var t=e.tableView,n=e.mailListItemSelectionSource,o=i.O.expandedConversationViewState.focusedNodeId;o?u.t(o):u.u(t,t.focusedRowKey,!0,n)});var F=n(1056),G=n(6132);Object(l.orchestrator)(G.a,function(e){var t=e.tableView,n=e.selectedNodeIds,o=e.selectedRowKeys,a=e.mailListItemSelectionSource;if(n.length>0&&a===F.a.KeyboardEnter){if(1!==n.length)return;u.b(n[0],Object(c.b)(n[0]).ItemId.Id,i.O.expandedConversationViewState.allNodeIds,t,a)}else{if(1!==o.length)return;u.r(t,o[0],!0,a)}})},4138:function(e,t,n){"use strict";var o=n(2267),a=n(49);t.a=Object(a.c)("expandCollapsedItemsRollUp",o.a.RPCountExpCollItemsRollUp)(function(e,t){void 0===t&&(t=!1),e.conversationNodeIdsInCollapsedItemsRollUp=[]})},4503:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(758);function a(e){var t;return null===(t=o.a.conversations.get(e))||void 0===t?void 0:t.canLoadMore}},4916:function(e,t,n){"use strict";var o=n(4138),a=n(2267),i=n(838),r=n(2621),c=n(151),s=n(49),d=n(1570),u=n(758),l=n(2757),v=n(69);t.a=Object(s.c)("loadMore",a.a.RPCountLoadMore)(Object(v.select)({conversations:function(){return u.a.conversations},conversationReadingPaneViewState:function(){return i.a.conversationReadingPaneViewState}})(function(e,t){if(e&&t.conversations.has(e.Id)){var n=t.conversations.get(e.Id);n.isLoadMoreInProgress=!0,n.maxItemsToReturn=n.maxItemsToReturn+d.a,n.syncState="";var a=Object(c.o)();return a&&a.addCustomData([(i=n.maxItemsToReturn,s=Math.ceil((i-20)/10),Object(l.a)(s))]),Object(r.b)(t.conversationReadingPaneViewState)&&Object(o.a)(t.conversationReadingPaneViewState,!0),Object(d.d)(e,"LoadMore")}var i,s;return Promise.resolve()}))},5431:function(e,t,n){"use strict";var o=n(0),a=n(3308),i=n(3301),r=n(1597),c=n(972),s=n(889),d=n(1581),u=n(69),l=n(731);t.a=Object(u.select)({composeViewState:function(){return s.a.viewStates.get(s.a.primaryComposeId)},conversationItems:function(){return l.O.conversationItems}})(Object(u.action)("reloadReadingPane")(function(e){var t,n,s=Object(l.B)(),u=s?Object(o.__spread)(s.selectedRowKeys.keys()):[];if(1==u.length){var v=l.b.getRowClientItemId(u[0],s),b=Object(d.a)(u,s)[0];switch(s.tableQuery.listViewType){case 0:var I=e.conversationItems.get(v.Id);(null===(t=e.composeViewState)||void 0===t?void 0:t.isInlineCompose)?c.x.importAndExecute(e.composeViewState).then(function(){Object(a.b)(v,b,I.subject)}):Object(a.b)(v,b,I.subject);break;case 1:(null===(n=e.composeViewState)||void 0===n?void 0:n.isInlineCompose)?c.x.importAndExecute(e.composeViewState).then(function(){Object(i.a)(v,b,r.a)}):Object(i.a)(v,b,r.a)}}}))},5434:function(e,t,n){"use strict";var o=n(4),a=Object(o.action)("ON_CONVERSATION_OPTION_SAVED");t.a=a},6125:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("UPDATE_LOADED_CONVERSATION_READING_PANE",function(e,t){return{conversationId:e,nodeIdCollectionChanged:t}})},6130:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_KEYBOARD_UP_DOWN",function(e,t,n,o){return{selectionDirection:e,tableView:t,mailListItemSelectionSource:n,shouldSelect:o}})},6131:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_KEYBOARD_TOGGLE_SELECT",function(e,t){return{tableView:e,mailListItemSelectionSource:t}})},6132:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_KEYBOARD_UP_DOWN",function(e,t,n,o){return{tableView:e,selectedNodeIds:t,selectedRowKeys:n,mailListItemSelectionSource:o}})},7088:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_ITEM_PART_SELECTED",function(e,t){return{conversationNodeId:e,conversationId:t}})}},0,[3,5,8,13,422,1,2,22,577,185,0,578,189,7,379,16,361,6,329,10,79,4,12,131,37,127,572,148,342,376]]);
//# sourceMappingURL=owa.ExpandedListSelectionActions.js.map
self.scriptsLoaded['owa.ExpandedListSelectionActions.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.ExpandedListSelectionActions.js'] = (new Date()).getTime();