self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.ArchiveAndSharedFolders.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[123],{14096:function(e,r,t){"use strict";t.r(r);var n=t(0),o=t(777),s=t(742),i=t(878),d=t(1210),a=t(801),c=t(1015),l=t.n(c),u=t(1670),f=t.n(u),b=t(743),v=t.n(b),h=t(1671),O=t.n(h),j=t(191);function p(e,r){return O()({Header:Object(j.getJsonRequestHeader)(),Body:f()({FolderShape:l()({BaseShape:"IdOnly",AdditionalProperties:[v()({FieldURI:"ReplicaList"})]}),FolderIds:e})},r).then(function(e){return e.Body.ResponseMessages.Items})}var F=t(760),m=t(71);var g=t(1211),_=t(151),P=t(324),I=t.n(P),R=t(4),S=t(734);Object(R.orchestrator)(s.c,function(e){return Object(n.__awaiter)(void 0,void 0,void 0,function(){var r,t;return Object(n.__generator)(this,function(s){switch(s.label){case 0:return(r=Object(i.a)(S.d))==F.a.Loading||r==F.a.Loaded?[2]:(Object(o.h)(S.d,F.a.Loading),[4,Object(d.a)(I()({Id:S.d}))]);case 1:return(t=s.sent())&&t.RootFolder&&t.RootFolder.Folders&&t.RootFolder.ParentFolder?(Object(o.e)(t.RootFolder,S.d,S.c,Object(g.a)(),Object(m.f)().SessionSettings.ArchiveDisplayName,S.d),l=t.RootFolder,u=l.ParentFolder,Object(m.a)(u.DistinguishedFolderId,u.FolderId.Id),l.Folders.filter(function(e){return e.DistinguishedFolderId&&e.ParentFolderId.Id==u.FolderId.Id}).forEach(function(e){return Object(m.a)(e.DistinguishedFolderId,e.FolderId.Id)}),Object(o.b)(),c=e.source,Object(_.m)("Triage_LoadArchiveMailboxFolders",[c]),function(e){Object(n.__awaiter)(this,void 0,void 0,function(){var r;return Object(n.__generator)(this,function(t){switch(t.label){case 0:return 0==e.length?[2]:[4,p(e,Object(a.a)(S.d))];case 1:return(r=t.sent())&&r.forEach(function(e){e.Folders.forEach(function(e){var r;(null===(r=e)||void 0===r?void 0:r.ReplicaList)&&Object(o.i)(e.FolderId.Id,e.ReplicaList)})}),[2]}})})}(t.RootFolder.Folders.map(function(e){return e.FolderId})),[2]):(Object(o.h)(S.d,F.a.ErrorLoading),[2])}var c,l,u})})});var y=t(981),w=t.n(y),M=t(982),A=t.n(M),T="X-OWA-ExplicitLogonUser",L="X-AnchorMailbox";function U(e,r){var t=function(e){return A()({FolderShape:l()({BaseShape:"IdOnly",AdditionalProperties:[v()({FieldURI:"DistinguishedFolderId"}),v()({FieldURI:"FolderClass"}),v()({FieldURI:"FolderDisplayName"}),v()({FieldURI:"ParentFolderId"}),v()({FieldURI:"TotalCount"}),v()({FieldURI:"UnreadCount"})]}),Paging:null,ParentFolderIds:e,ReturnParentFolder:!0,ShapeName:"Folder",Traversal:"Deep"})}(e);return w()({Header:Object(j.getJsonRequestHeader)(),Body:t},function(e){var r;return{headers:(r={},r[T]=e,r[L]=e,r)}}(r)).then(function(e){return e.Body.ResponseMessages.Items[0]&&"Success"!==e.Body.ResponseMessages.Items[0].ResponseClass&&e.Body.ResponseMessages.Items.length>1?e.Body.ResponseMessages.Items[1]:e.Body.ResponseMessages.Items[0]})}var D=t(882),E=t(62),B=t(49);Object(R.orchestrator)(s.g,function(e){return Object(n.__awaiter)(void 0,void 0,void 0,function(){var r,t,d,a;return Object(n.__generator)(this,function(n){switch(n.label){case 0:if((r=Object(i.a)(e.principalSMTPAddress))==F.a.Loading||r==F.a.Loaded)return[2];Object(o.h)(e.principalSMTPAddress,F.a.Loading),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,U([I()({Id:S.k}),I()({Id:"inbox"})],e.principalSMTPAddress)];case 2:return t=n.sent(),[3,4];case 3:return d=n.sent(),E.d.error("FindFolder API returned error "+d),[3,4];case 4:return t&&t.RootFolder&&t.RootFolder.Folders&&t.RootFolder.ParentFolder?(a=Object(D.a)(e.principalSMTPAddress).DisplayName,Object(o.e)(t.RootFolder,S.k,S.j,e.principalSMTPAddress,a,e.principalSMTPAddress),c=t.RootFolder.Folders.length,Object(_.m)("Triage_SharedFolders_OpenFolder",[Object(B.d)({value:c})]),[2]):(Object(s.j)(e.principalSMTPAddress,e.actionSource),Object(o.h)(e.principalSMTPAddress,F.a.ErrorLoading),[2])}var c})})});Object(R.orchestrator)(o.b,function(){return Object(n.__awaiter)(void 0,void 0,void 0,function(){var e,r;return Object(n.__generator)(this,function(t){switch(t.label){case 0:return[4,Object(d.a)(I()({Id:S.b}))];case 1:return(e=t.sent())&&e.RootFolder&&e.RootFolder.Folders&&e.RootFolder.ParentFolder?(Object(o.d)(e.RootFolder,S.c,Object(g.a)()),r=e.RootFolder.ParentFolder,Object(m.a)(r.DistinguishedFolderId,r.FolderId.Id),[2]):[2]}})})});var x=t(9996),q=t.n(x);Object(R.orchestrator)(s.k,function(e){return Object(n.__awaiter)(void 0,void 0,void 0,function(){var r,t,s;return Object(n.__generator)(this,function(n){switch(n.label){case 0:r=e.principalSMTPAddress,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(i=r,q()({primarySMTPAddress:i}))];case 2:return t=n.sent(),[3,4];case 3:return s=n.sent(),E.d.error("Remove shared folders server call failed with error "+s),[3,4];case 4:return t?(Object(o.g)(r),Object(o.f)(r),Object(_.m)("Triage_SharedFolders_RemoveFolder")):E.d.error("Remove shared folders server call returned false"),[2]}var i})})});var C=t(747),k=t.n(C);Object(R.orchestrator)(s.d,function(e){return Object(n.__awaiter)(void 0,void 0,void 0,function(){var r,t,o,i,d,a;return Object(n.__generator)(this,function(n){switch(n.label){case 0:r=e.folderId,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(c=r,u=["PermissionSet"],b=u.map(function(e){return v()({FieldURI:e})}),O()({Header:Object(j.getJsonRequestHeader)(),Body:f()({FolderShape:l()({BaseShape:"IdOnly",AdditionalProperties:b}),FolderIds:[k()({Id:c})]})}).then(function(e){return e.Body.ResponseMessages.Items[0]}))];case 2:return t=n.sent(),[3,4];case 3:throw o=n.sent(),Object(s.e)(),o;case 4:return t&&"Success"==t.ResponseClass&&((i=null===(a=t.Folders)||void 0===a?void 0:a[0])?(d=i.PermissionSet.Permissions,Object(s.n)(r,d),Object(s.f)(),function(e){var r=e.length;Object(_.m)("Triage_FolderPermissions_Load",[Object(B.d)({value:r})])}(d)):(Object(s.e)(),E.d.error("Get folder permission server call returned with no matching folders."))),[2]}var c,u,b})})});var H=t(746);function G(e,r){return!e&&!r||!(!e||!r)&&(e.length===r.length&&!e.some(function(e,t){return!N(e,r[t])}))}function N(e,r){return!e&&!r||!(!e||!r)&&!Object.keys(e).some(function(t){if("UserId"===t){var n=e[t];return n.PrimarySmtpAddress?n.PrimarySmtpAddress!==r[t].PrimarySmtpAddress:n.DistinguishedUser!==r[t].DistinguishedUser}return e[t]!==r[t]})}var J=t(883),z=t(1114),X=t.n(z),$=t(931),W=t.n($),K=function(e,r){return Object(J.a)(e,[X()({Path:v()({FieldURI:"PermissionSet"}),Folder:W()({PermissionSet:r})})])};Object(R.orchestrator)(s.l,function(e){return Object(n.__awaiter)(void 0,void 0,void 0,function(){var r,t,o,i,d,a;return Object(n.__generator)(this,function(c){switch(c.label){case 0:if(r=e.folderId,t=e.permissions,o=Object(H.a)().get(r),G(null===(a=o.PermissionSet)||void 0===a?void 0:a.Permissions,t))return Object(s.o)(),[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,K(r,{Permissions:t})];case 2:return i=c.sent(),[3,4];case 3:return d=c.sent(),Object(s.m)(),E.d.error("Update folder permission on server call failed with error "+d),[2];case 4:return i&&"Success"==i.ResponseClass?(Object(s.n)(r,t),Object(s.o)(),function(e){var r,t,o=e.length,s={};e.forEach(function(e){var n=e.PermissionLevel,o=e.UserId;"Default"===o.DistinguishedUser?r=e:"Anonymous"===o.DistinguishedUser&&(t=e),s[n]||(s[n]=0),s[n]+=1}),Object(_.m)("Triage_FolderPermissions_Edit",Object(n.__assign)({owa_1:Object(B.d)({value:o}),owa_2:r.PermissionLevel,owa_3:t.PermissionLevel},s))}(t)):(Object(s.m)(),E.d.error("Update folder permission on server call failed")),[2]}})})});var Q=t(881);Object(R.mutator)(o.g,function(e){var r=Object(Q.a)(),t=r.indexOf(e.principalSMTPAddress);-1!==t?r.splice(t,1):E.d.error("Trying to remove a non-existent shared folder user : "+e.principalSMTPAddress)});Object(R.mutator)(s.n,function(e){var r=e.folderId,t=function(e){return e.map(function(e){var r=Object(n.__assign)({IsFolderContact:!1},e);return delete r.__type,r})}(e.permissions),o=Object(H.a)().get(r);o&&(o.PermissionSet?o.PermissionSet.Permissions=t:o.PermissionSet={Permissions:t})}),Object(R.mutator)(o.i,function(e){var r=Object(H.a)().get(e.folderId);r&&(r.ReplicaList=e.replicaList)});var V=t(9997),Y=t.n(V);function Z(){var e;return Object(n.__awaiter)(this,void 0,void 0,function(){var r,t;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return[4,Y()({})];case 1:return r=n.sent(),(t=null===(e=r)||void 0===e?void 0:e.OtherMailboxEntries)?t.length>0&&(t.forEach(function(e){Object(s.a)(e.DisplayName,e.PrincipalSMTPAddress,!0)}),o=t.length,Object(_.m)("Triage_SharedFolders_LoadList",[Object(B.d)({value:o})])):E.d.error("initializeSharedFolderRoots failed with getOtherMailboxConfiguration response as : "+r),[2]}var o})})}t.d(r,"getArchiveFolders",function(){return s.c}),t.d(r,"getSharedFolders",function(){return s.g}),t.d(r,"removeSharedFolderUser",function(){return s.k}),t.d(r,"getFolderPermissions",function(){return s.d}),t.d(r,"updateFolderPermissions",function(){return s.l}),t.d(r,"updateFolderPermissionsInStore",function(){return s.n}),t.d(r,"arePermissionArraysEqual",function(){return G}),t.d(r,"arePermissionsEqual",function(){return N}),t.d(r,"initializeSharedFolderRoots",function(){return Z})},1670:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(0);r.default=function(e){return n.__assign({__type:"GetFolderRequest:#Exchange"},e)}},1671:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(129),o=t(2085);r.default=function(e,r){return void 0===e||e.__type||(e=o.default(e)),n.makeServiceRequest("GetFolder",e,r)}},2085:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(0);r.default=function(e){return n.__assign({__type:"GetFolderJsonRequest:#Exchange"},e)}},9996:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(129);r.default=function(e,r){return n.makeServiceRequest("RemoveSharedFolders",e,r)}},9997:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(129);r.default=function(e,r){return n.makeServiceRequest("GetOtherMailboxConfiguration",e,r)}}}]);
//# sourceMappingURL=owa.ArchiveAndSharedFolders.js.map
self.scriptsLoaded['owa.ArchiveAndSharedFolders.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.ArchiveAndSharedFolders.js'] = (new Date()).getTime();