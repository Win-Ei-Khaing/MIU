self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.4.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[4],{152:function(e,t,n){"use strict";var r=n(0),o=n(161),i=n(137),c=n(179),u=n(298),a=n.n(u),s=n(45),l=n(339),d=n.n(l),f=n(49),_=500,h="OWA_GetAccessTokenForResource";function b(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){return t={isUserActivity:!1},[2,d()(a()({Resource:e}),t)]})})}function v(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(r){return t<1?(Object(f.g)(h,[e,t,n.toString()]),[2,Promise.reject()]):[2,b(e).catch(function(n){return Object(s.a)(_).then(function(){return v(e,t-1,n)})})]})})}var g,p=n(65),O=n(251),j=3,w=500;function k(e){var t=this,n=null,o=null,i=new Promise(function(e,i){return Object(r.__awaiter)(t,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return n=e,o=i,[2]})})}),c={onFulfilled:n,onRejected:o,resource:e};return(null==g&&(g=new O.a(j,m,w)),g).add(c),i}function m(e){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return q(e.resource).then(function(t){e.onFulfilled(t)}).catch(function(t){e.onRejected(t)}),[2]})})}var T=n(166);n.d(t,"e",function(){return E}),n.d(t,"b",function(){return R}),n.d(t,"c",function(){return x}),n.d(t,"a",function(){return q}),n.d(t,"d",function(){return D});var A=1,C=12e4,I=3,y=null;function E(e){y=e}function R(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){switch(n.label){case 0:return null!=(t=D(U(),e))?[3,2]:[4,q(e)];case 1:t=n.sent(),n.label=2;case 2:return[2,null!=t?t.AccessToken:void 0]}})})}function x(e){var t=D(U(),e);if(t)return[t.AccessToken,void 0];if(Object(p.f)("auth-getAccessTokenQueueEnabled")){var n=Object(T.a)(e),r=void 0;return n?r=n:(r=k(e),Object(T.b)(e,r)),[void 0,r.then(function(t){return Object(T.c)(e),t.AccessToken})]}return[void 0,q(e).then(function(e){return e.AccessToken})]}function q(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,n,o;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return Object(p.f)("auth-getAccessTokenQueueEnabled")?[4,v(e,I)]:[3,2];case 1:return n=r.sent(),[3,4];case 2:return[4,b(e)];case 3:n=r.sent(),r.label=4;case 4:return null!=(t=n)&&0==t.TokenResultCode&&null!=t.AccessTokenExpiry&&(t.ExpiresIn&&t.ExpiresIn>0&&(t.AccessTokenExpiry=Object(c.a)(Date.now(),t.ExpiresIn).toISOString()),(o=new Date(t.AccessTokenExpiry).getTime()-Date.now()-C)>0&&U().put(e,t,o,function(e,t){q(e).catch(function(t){Object(f.g)(h,{category:"Cache_Expired",err:t.toString(),message:t.message,stk:t.stack,resource:e})})})),[2,t]}})})}function D(e,t){var n,r=e.get(t),o=void 0;(null===(n=r)||void 0===n?void 0:n.AccessTokenExpiry)&&(Object(i.a)(new Date(r.AccessTokenExpiry),-A)>new Date(Date.now())&&(o=r));return o}function U(){return null==y&&(y=new o.Cache),y}},166:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"b",function(){return a});var r=n(161),o=null;function i(){return null==o&&(o=new r.Cache),o}function c(e){return i().get(e)}function u(e){return i().del(e)}function a(e,t){i().put(e,t)}},467:function(e,t,n){"use strict";n.r(t);var r=n(161),o=n(152);function i(e){Object(o.e)(new r.Cache),Object(o.b)(e.location.origin)}var c=n(0),u=n(39),a=n(181),s=n.n(a),l=n(179),d=n(49),f="OWA_GetDelegationAccessToken",_={};function h(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r,o;return Object(c.__generator)(this,function(i){switch(i.label){case 0:t=e.client_id+e.scope,n=encodeURIComponent(t),r={},i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,b(e,window)];case 2:return r=i.sent(),[3,5];case 3:return o=i.sent(),r.TokenResultCode=2,Object(d.g)(f+" Token fetch failure ",{err:o.toString(),message:o.message,stk:o.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",_[e]),t.document.body.removeChild(n),delete _[e])}(n,window),[7];case 5:return[2,r]}})})}function b(e,t){return Object(c.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(c.__generator)(this,function(i){return n=encodeURIComponent(e.client_id+e.scope),r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+u.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((o=t.document.createElement("iframe")).src=r.toString(),o.style.display="none",o.id=n,t.document.body.appendChild(o),[2,new Promise(function(r,i){_[n]=function(n){var c={};try{o.contentWindow&&o.contentWindow.location.host==t.location.host&&(c=function(e,t){var n=u.parse(e),r={};n.access_token?(r.AccessToken=n.access_token,r.AccessTokenExpiry=Object(l.a)(Date.now(),parseInt(n.expires_in)).toISOString(),r.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(r.TokenResultCode=3,Object(d.g)(f+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(r.TokenResultCode=2,Object(d.g)(f+" MSA Failure",{error:n.error,param:e,requestId:t}));return r}(o.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(d.g)(f+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),c.TokenResultCode=2,i(c)}r(c)},o.addEventListener("load",_[n],!1)})])})})}var v,g=n(65),p=n(166),O=n(251),j=3,w=500;function k(e){var t=this,n=null,r=null,o=new Promise(function(e,o){return Object(c.__awaiter)(t,void 0,void 0,function(){return Object(c.__generator)(this,function(t){return n=e,r=o,[2]})})}),i={onFulfilled:n,onRejected:r,options:e};return(null==v&&(v=new O.a(j,m,w)),v).add(i),o}function m(e){return Object(c.__awaiter)(this,void 0,void 0,function(){return Object(c.__generator)(this,function(t){return h(e.options).then(function(t){e.onFulfilled(t)}).catch(function(t){e.onRejected(t)}),[2]})})}var T=n(347),A=n(319),C=null,I="OWA_GetDelegationAccessToken",y="https://login.live.com/oauth20_authorize.srf",E="/owa/auth/dt.aspx",R="292841";function x(e,t){return Object(c.__awaiter)(this,void 0,void 0,function(){var n,r,o,i,a;return Object(c.__generator)(this,function(c){switch(c.label){case 0:n={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:t||Object(A.a)()},r=void 0,o=void 0,c.label=1;case 1:return c.trys.push([1,7,,8]),Object(g.f)("auth-disableGetAuthenticationCall")?[4,q(S(n))]:[3,3];case 2:return r=c.sent(),[3,6];case 3:return[4,s()()];case 4:return 0!=(o=c.sent()).ResultCode||null==o.ImplicitGrantAuthorizationUrl||""==o.ImplicitGrantAuthorizationUrl?(Object(d.g)(I+" ImplicitGrantAuthorizationUrl is empty or null ",{scope:e,correlationId:n.requestId}),[2,r]):(i=u.parse(o.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&i.redirect_uri?(n.client_id=i.client_id,n.authorization_uri=o.ImplicitGrantAuthorizationUrl.split("?")[0],n.redirect_uri=i.redirect_uri,[4,q(n)]):[3,6];case 5:r=c.sent(),c.label=6;case 6:return[2,r];case 7:return a=c.sent(),Object(d.g)(I+" GetDelegationToken Operation failed ",{err:a.toString(),message:a.message,stk:a.stack||"",scope:e,requestId:n.requestId}),[2,r];case 8:return[2]}})})}function q(e){var t;return Object(c.__awaiter)(this,void 0,void 0,function(){var n,r,i,u;return Object(c.__generator)(this,function(c){switch(c.label){case 0:return n=e.client_id+e.scope,r=Object(o.d)(U(),n),(null===(t=r)||void 0===t?void 0:t.AccessToken)?[2,r.AccessToken]:[3,1];case 1:return Object(g.f)("auth-getDelegationTokenQueueEnabled")?(i=Object(p.a)(n),u=void 0,i?u=i:(u=k(e),Object(p.b)(n,u)),[2,u.then(function(e){return D(n,e),Object(p.c)(n),e.AccessToken})]):[3,2];case 2:return[4,h(e)];case 3:return r=c.sent(),D(n,r),[2,0==r.TokenResultCode?r.AccessToken:void 0]}})})}function D(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&U().put(e,t,n)}}function U(){return null==C&&(C=new r.Cache),C}function S(e){return e.redirect_uri=Object(T.a)()+E,e.authorization_uri=y,e.client_id=R,e}var z=n(120),F=n(355);var G=!1;function P(e){G||(!function(e){var t=Object(F.a)("/owa",e);Object(z.updateServiceConfig)({baseUrl:t})}(e),G=!0)}function W(e,t,n,r){n?e.acquireTokenPopup(t,null,n,r):e.acquireToken(t,r)}var B=n(52),L=new B.c(function(){return Promise.all([n.e(565),n.e(110)]).then(n.bind(null,14350))}),Q=new B.a(L,function(e){return e.createAdalAuthenticationContext});var M=function(e,t,n,r){return function(o,i){o||!i?r(o,null):(e.getCachedUser(),W(e,t,n,r))}},$="adalIdTokenFrame";function H(e,t,n,r){e.config.displayCall=function(o){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(o),window.detectUserCachedCallback=M(e,t,n,r),function(e,t){e._addAdalFrame($).src="about:blank",e._loadFrame(t+"&prompt=none",$)}(e,o)},e.login()}function J(e,t,n,r,o){return Object(c.__awaiter)(this,void 0,void 0,function(){var i;return Object(c.__generator)(this,function(c){switch(c.label){case 0:return"https://login.microsoftonline.com/",[4,Q.importAndExecute("https://login.microsoftonline.com/",e,t)];case 1:return i=c.sent(),i.getCachedUser()?W(i,n,r,o):H(i,n,r,o),[2]}})})}n.d(t,"registerTokenProvider",function(){return i}),n.d(t,"getAccessTokenforResource",function(){return o.b}),n.d(t,"getAccessTokenforResourceAsLazy",function(){return o.c}),n.d(t,"getDelegationToken",function(){return q}),n.d(t,"getDelegationTokenForOwa",function(){return x}),n.d(t,"bootstrap",function(){return P}),n.d(t,"getAccessTokenOnBehalfOfResource",function(){return J})}}]);
//# sourceMappingURL=owa.4.js.map
self.scriptsLoaded['owa.4.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.4.js'] = (new Date()).getTime();