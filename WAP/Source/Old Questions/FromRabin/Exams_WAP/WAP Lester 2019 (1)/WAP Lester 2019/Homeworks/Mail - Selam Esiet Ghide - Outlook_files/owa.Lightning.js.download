self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.Lightning.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[317],{14128:function(e,n,t){"use strict";t.r(n);var i=t(62),r=t(69),a=t(0),o=t(3),c=t(21),u=t(1010),l=Object(r.action)("initializeLightning")(function(e){var n,t;if(i.d.info("initialize lightning store"),Object(u.a)().lastShownId=null,Object(u.a)().lightedCount=0,Object(u.a)().unseenItems=new c.ObservableMap,e)try{for(var r=Object(a.__values)(e),o=r.next();!o.done;o=r.next()){var l=o.value;Object(u.a)().unseenItems.set(l.identity,l)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}});var s=t(112),g="ows/v1.0/lightning/items/unseen";function d(){return i.d.info("initialize lightning from server"),Object(s.b)(g).then(function(e){var n=e.map(f);l(n)})}function f(e){return e.category?{identity:e.id,visible:!1,category:e.category}:{identity:e,visible:!1}}var h,b=t(40),v=t(65),O="lightning",j="UnseenLightening";function m(){var e,n,t;if(!h){var r=Object(o.a)(O);if(r)h=function(e){i.d.info("initialize lightning from override query parameter");var n=e.split(",").map(function(e){return{identity:e,visible:!1}});return l(n),Promise.resolve()}(r);else{var c=Object(b.a)().PrimeSettings;if(Object(v.f)("lightning-initFromSD")&&c&&c.Items)try{for(var u=Object(a.__values)(c.Items),s=u.next();!s.done;s=u.next()){var g=s.value;if(g.Id===j&&g.Value){t=g.Value,i.d.info("initialize lightning from session data"),l(t.map(function(e){return{identity:e.id,visible:!1,category:e.category}})),h=Promise.resolve();break}}}catch(n){e={error:n}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}h||(h=d())}}return h}var y,I=t(151),w=Object(r.action)("lightup")(function(e){i.d.info("lightup - id:"+e),Object(u.a)().lastShownId=e,Object(u.a)().lightedCount++;var n=Object(u.a)().unseenItems.get(e);n&&(n.visible=!0),Object(I.m)("LIGHTUP",[e])}),p=t(797);function S(e,n){(i.d.info("lightupOrReject - id:"+e+", recurrenceCount:"+n+", lightedCount:"+Object(u.a)().lightedCount+", lastShown:"+Object(u.a)().lastShownId),Object(p.u)(location))?i.d.info("lightning is disabled for deeplink"):Object(u.a)().unseenItems.has(e)&&(!Object(u.a)().lastShownId||function(e,n){var t=!1,i=Object(u.a)().lastShownId;if(i&&n&&!function(){var e=Object(u.a)(),n=e.lastShownId,t=e.unseenItems;return n&&t.has(n)&&t.get(n).visible}()){var r=n.indexOf(i),a=n.indexOf(e);r>=0&&r+1==a&&(t=!0)}return t}(e,n)||function(e){var n=Object(u.a)().unseenItems.get(e);return!!n&&n.category==y.UIFeatureDiscovery}(e))&&w(e)}!function(e){e.None="0",e.UpSell="1",e.FeatureDiscovery="2",e.TeachingMoment="3",e.UITeachingMoment="4",e.UIFeatureDiscovery="5",e.UIUpSell="6",e.JITNewUser="7",e.Compliance="8",e.SatCoreMetric="9",e.UpSellExperiment="10"}(y||(y={}));var L=Object(r.action)("beginLightning")(function(e,n,t){i.d.info("beginLightning - id:"+e),n(function(){m().then(function(){return S(e,t)}).catch(function(n){i.d.warn("something is wrong, lightning id:"+e+", reason:"+n)})})}),U="ows/v1.0/lightning/items";function x(e,n){return void 0===n&&(n="Primary"),Object(s.e)(U+"/"+e+"?actionType="+n,{id:e})}var _=Object(r.action)("endLightning")(function(e,n){return Object(a.__awaiter)(this,void 0,void 0,function(){var t;return Object(a.__generator)(this,function(r){return i.d.info("endLightning - id:"+e),t=Object(u.a)().unseenItems,Object(u.a)().lastShownId==e&&t.has(e)&&t.get(e).visible?(t.delete(e),Object(I.m)("Lighted",[e]),Object(o.d)("lightning")?(i.d.info("skipping the update because override exists"),[2]):[2,x(e,n)]):[2]})})});t.d(n,"beginLightningImp",function(){return L}),t.d(n,"endLightningImp",function(){return _})}}]);
//# sourceMappingURL=owa.Lightning.js.map
self.scriptsLoaded['owa.Lightning.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.Lightning.js'] = (new Date()).getTime();